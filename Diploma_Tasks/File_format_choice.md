# Задача №1 - выбор метода заполнения готовых шаблонов документов без потери первоначального вида с сохранением наложенных изображений

## Процесс решения

Головная организация - автор документов в формате Word для занесения информации по различным категориям и мероприятиям. Шаблоны, которые на данный момент заполняются от руки, утверждены РКФ и не могут быть изменены. 
Проблема - заполнение шаблонов документов информацией таким образом, чтобы не менять структуру документа и сохранить все полупрозрачные изображения на их первоначальных местах.
Возможные решения:

- создание предварительных пользовательских форм для заполнения и перенос из них информации в шаблонный документ Word
- преобразование файлов Word в PDF и настройка заполняемых полей
- преобразование odt в zip архив для модификации xml, архивирование обратно в zip и смена формата на odt через смену имени
- использование специализированных библиотек для работы с форматами файлов

Рассмотрим каждый из вариантов и выберем наиболее удобный по степени сложности реализации.
В первом случае стоит помнить об особенностях работы с файлами Word. При заполнении документов таким образом весь набранный текст имеет свойство сдвигаться по строкам, поэтому для корректного заполнения шаблонов от РКФ необходимо предварительно посчитать количество допустимых к вводу символов для каждого поля. 
Следующая особенность в работу с Word документами - технический вопрос. Для работы с файлами необходимо их заранее преобразовать в другие форматы для обеспечения возможности заполнения при помощи программного кода. Для корректной работы необходимо работать с ZIP и XML файлами. Это повышает сложность сохранения у документа его первоначального вида и повышает риск нарушения его структуры, что в случае системы недопустимо.

Важной особенностью в работе с Word форматом является использование соответствующих технологий. Заполнение файлом может быть реализовано при помощи COM-объектов, но это трудозатратно и требует наличие Microsoft Word на стороне клиента и сервера. Также данный способ ограничивает нас в возможности портирования сервиса на другие платформы кроме персональных компьютеров на операционной системе Windows. Решение данной проблемы может стать создание отдельного агента на операционной системе Windows, который будет взаимодействовать с файлами Word и по завершении преобразований отсылать готовый документ к системе. Последняя из выявленных проблем, лежащих на поверхности, это различия в работе с файлами Word различных версий программы. Отличие версии гарантирует разность в восприятии электронным устройством информации из файла и нарушение разметки внутри файла, что недопустимо для системы.
Другим возможным способом взаимодействия с файлами может стать формат odt. 

Во втором случае решается несколько из выше упомянутых проблем и сложностей работы с документами в формате Word. Во-первых, PDF файлы не подвержены сдвигу текста при его вводе в заполняемые поля. Во-вторых, версионность не подвергает разметку информации внутри файлов изменениям. В-третьих, для обработки PDF файлов достаточно подключения специальных библиотек, нет необходимости преобразовывать файлы в ZIP и XML как в первом случае. Однако, данный метод имеет свои недоставки в том числе. По сколько такие файлы изначально не подразумевают заполнение, необходимо вставить поля для ввода текста. Далее рассчитать количество символов для корректного отображения после переноса текста из формы в поле. Как отмечалось ранее Word имеет ограничения в работе на других системах. PDF не имеет таких ограничений и имеет возможность отрисовки для всех известных платформах, что делает его более универсальным в использовании.

Для окончательного выбора способа реализации взаимодействия с документами необходимо разработать несколько тестовых проектов с функционалом по записи информации внутрь документов и проверки конечного внешнего вида.

В процессе разработки тестовой программы на фреймфорке QT для языка программирования C++ опытным путём выяснилось, что изменение готового шаблона в odt формате не представляется возможным через нахождение маркера на строке и его замены на нужные данные. Структура файла нарушается и возможность его чтения после внесения изменений не представлялась возможной. Данная особенность требует большего изучения и нахождения другого способа модификации файла для сохранения возможности чтения и без потери файла.
Выяснилось, что данный формат хранения информации, разработанный OASIS (Организация по развитию стандартов структурированной информации), представляет собой запакованный ZIP-архив из файлов XML и файлов изображений. Изменение подобного рода структуры без таргетированного модифицирования файлов XML при помощи библиотек с сохранением возможности открытия файла возможно. 

При тестовых сборках программ на фреймворке Qt версии 6.5 стало известно о существовании библиотеки QuaZip для запаковывания файла обратно в odt формат. Однако для новейшей версии Qt данная библиотека не подходит в виду использования устаревшего компонента и отсутствия должной поддержки уже несколько лет. Библиотека ищёт нового вендера.

Для решения проблемы с запаковкой архива обратно в odt формат можно использовать вызов архиватора напрямую из программы. После распаковки файла в папку, где будут хранится xml и png файлы необходимо заархивировать содержимое папки обратно. Программы архиваторы не поддерживают архивацию в формат odt. Сначала нужно запаковать файлы и папки в zip архив, а далее сменить ему имя. Таким образом получится прочесть файл. В тестовой реализации удалось реализовать программу по вводу текстовых значений через элемент lineEdit для последующей замены маркеров внутри content.xml. После замены, архивации и смены расширения получилось создать файл odt для чтения, доступный для чтения через LibreOffice вместе с изображениями.